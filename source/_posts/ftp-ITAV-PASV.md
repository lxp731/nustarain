---
title: FTP服务器的主动模式和被动模式
date: 2023-10-06 10:42:03
categories: 理论知识
tags:
  - 面试
  - 网络基础
---

### 主动模式与被动模式

FTP（File Transfer Protocol）是一种用于在计算机之间传输文件的协议，它有两种常见的模式：主动模式（Active Mode）和被动模式（Passive Mode）。这两种模式在建立数据连接时的方式不同，适用于不同的网络环境和安全要求。

<!-- more -->

以下是对主动模式和被动模式的详细阐述：

1. **主动模式（Active Mode）**：

- 在主动模式中，客户端（FTP 客户端）发起连接，客户端的命令连接是从客户端的随机端口（通常是大于1023的端口）发起的。

- 当客户端需要下载文件时，它会向服务器发送一个PORT命令，其中包括它要监听的数据连接端口号和地址。服务器将在该端口上建立数据连接，并将数据传输到客户端的指定端口。

- 主动模式在防火墙和NAT（网络地址转换）背后可能会遇到问题，因为服务器需要连接到客户端的随机端口，这些端口可能被防火墙或NAT设备拦截或阻止。

2. **被动模式（Passive Mode）**：

- 在被动模式中，服务器发起数据连接。客户端的命令连接仍然是从客户端发起的，但数据连接是从服务器的随机端口发起的。

- 当客户端需要下载文件时，它会向服务器发送一个PASV命令，服务器将随机选择一个端口并通知客户端。然后，客户端建立一个新的数据连接到服务器的指定端口，服务器将在该端口上传输数据。

- 被动模式通常更适合在防火墙和NAT后面的环境中，因为客户端可以通过建立对服务器的新数据连接来绕过防火墙或NAT设备。

总结：
- 主动模式需要客户端打开一个端口以供服务器连接，可能需要处理防火墙和NAT的问题。
- 被动模式需要服务器打开一个端口以供客户端连接，更容易在防火墙和NAT环境中工作。
- 选择模式取决于网络架构和安全需求，被动模式在大多数情况下更为常见。FTP客户端和服务器通常都支持这两种模式，可以根据需要进行配置。

### 21 端口与 20 端口

在FTP中，端口21和端口20扮演着不同的角色，分别用于控制连接和数据连接。以下是它们的作用和功能的详细阐述：

1. **端口21（FTP控制端口）**：

- 端口21是FTP的控制连接端口，也称为命令端口。
- 当一个FTP客户端需要连接到一个FTP服务器时，它首先建立一个连接到服务器的端口21。这个连接用于传输FTP命令，例如登录、切换目录、列出文件、获取文件等。
- 控制连接是明文的，通常不加密，但可以通过FTP服务器的配置来启用FTP的加密传输（如FTPS或SFTP）来提高安全性。

2. **端口20（FTP数据端口）**：

- 端口20是FTP的数据连接端口，也称为数据传输端口。
- 当FTP客户端和服务器需要传输文件或数据时，数据连接将在端口20上建立。
- 在FTP的主动模式中，服务器使用端口20向客户端发起数据连接。这意味着服务器将发送数据给客户端的端口20。在FTP的被动模式中，客户端会随机选择一个端口，然后服务器将在客户端选择的端口上建立数据连接。

总结：
- 端口21用于FTP的控制连接，用于传输FTP命令和控制操作。
- 端口20用于FTP的数据连接，用于实际的数据传输，如文件传输。
- 这两个端口在FTP协议中扮演不同的角色，用于支持FTP的命令和数据传输，共同构成了FTP通信的基础。